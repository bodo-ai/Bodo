name: Release
on:
  schedule:
    - cron: '0 21 * * *'  # Every day at 9PM EST
  release:
    types: [published]
  workflow_dispatch:

jobs:
  bodo-conda-community:
    strategy:
      # Don't cancel other jobs if one fails
      fail-fast: false
      matrix:
        python-version: ['3.12', '3.11', '3.10']
    uses: Bodo-inc/Bodo/.github/workflows/_build_bodo_conda.yml@develop
    with:
      python-version: ${{ matrix.python-version }}
      platform-build: false
      is-release: ${{ github.event_name == 'release' }}
    secrets: inherit

  bodo-conda-platform:
    uses: Bodo-inc/Bodo/.github/workflows/_build_bodo_conda.yml@develop
    with:
      python-version: '3.12'
      platform-build: true
      is-release: ${{ github.event_name == 'release' }}
    secrets: inherit

  iceberg-conda:
    uses: Bodo-inc/Bodo/.github/workflows/_build_iceberg_conda.yml@slade/connect-iceberg-sas
    secrets: inherit

  azurefs-sas-conda:
    uses: Bodo-inc/Bodo/.github/workflows/_build_azurefs_sas_token_provider_conda.yml@slade/connect-iceberg-sas
    secrets: inherit

  # TODO: Include BodoSQL, E2E tests, and AMI
