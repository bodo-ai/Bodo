
# Azure Pipeline that is triggered weekdays at midnight or when a release is tagged.

trigger:
- refs/tags/*

pr: none


#Currently nightly can take up to ~12 hours to run. 1 AM is a good time to start.
# (Note that this is in UTC time, so 1AM UTC is 8PM EST)
schedules:
- cron: "0 1 * * MON-FRI"
  displayName: 'Weekdays Daily midnight build'
  branches:
    include:
    - develop

parameters:
  - name: BUILD_MAC_CONDA
    type: boolean
    default: false
  - name: BUILD_PIP
    type: boolean
    default: false

# NOTE: these variables determine artifactory channel to publish Bodo/BodoSQL/Iceberg packages.
# See get_channel.sh
# Originally added through Azure Pipeline UI.
# Azure pipeline UI includes AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY
variables:
  CHECK_LICENSE_EXPIRED: 1
  CHECK_LICENSE_CORE_COUNT: 1
  OBFUSCATE: 1

stages:
- stage: Build_Bodo_Binary_Linux_Conda
  displayName: 'Build Bodo Binary for Linux Conda'
  jobs:
  - job: find_suffix
    pool: ScalingVMSet
    steps:
    - script: |
        set -exo pipefail
        export BUILD_DATE=`date  +"%Y-%m-%d"`
        export FILE_SUFFIX=built-${BUILD_DATE}
        echo "##vso[task.setvariable variable=fileSuffix;isOutput=true]$FILE_SUFFIX"
      displayName: 'write FILE_SUFFIX'
      name: suffix_step
  - template: buildscripts/azure/azure-build-binary-linux-macos.yml
    parameters:
      name: Linux
      vmImage: ubuntu-latest
      platformBuild: false
      weeklyTest: false

# Additional Conda Packages. Usually disabled for Nightly Runs
# But useful to have when testing all Conda Builds
- stage: Build_Bodo_Binary_Other_Conda
  displayName: 'Build Bodo Binary for Other Conda'
  dependsOn: []
  condition: or(eq('${{ parameters.BUILD_MAC_CONDA }}', 'true'), in(variables['Build.Reason'], 'IndividualCI', 'BatchedCI'))
  jobs:
  - template: buildscripts/azure/azure-build-binary-linux-macos.yml
    parameters:
      name: macOS
      vmImage: macOS-latest
      platformBuild: false
      weeklyTest: false
#  - template: buildscripts/azure/azure-build-binary-windows.yml
#    parameters:
#      name: Windows
#      vmImage: windows-2019
  - template: buildscripts/azure/azure-build-binary-linux-macos.yml
    parameters:
      name: macOS_ARM
      vmImage: macOS-latest
      platformBuild: false
      weeklyTest: false
      buildARM: true

# Pip Packages. Usually disabled for Nightly Runs
# But useful to have when testing all Pip Builds
- stage: Build_Bodo_Binary_Pip
  displayName: 'Build Bodo Binary for Pip'
  dependsOn: []
  condition: or(eq('${{ parameters.BUILD_PIP }}', 'true'), in(variables['Build.Reason'], 'IndividualCI', 'BatchedCI'))
  jobs:
  - template: buildscripts/azure/azure-build-binary-linux-pip.yml
    parameters:
      name: Linux_pip
      vmImage: ubuntu-latest
      platformBuild: false
#  - template: buildscripts/azure/azure-build-binary-windows-pip.yml
#    parameters:
#      name: Windows_pip
#      vmImage: windows-2019
#      platformBuild: false
  # - template: buildscripts/azure/azure-build-binary-macos-x86-pip.yml
  #   parameters:
  #     name: macOS_x86_pip
  #     vmImage: macOS-latest
  #     platformBuild: false

# Note: It is difficult to enforce the exact version of bodo to use for the build, outside of
# modifying the build recipe. Therefore, if we update BodoSQL's build process to require a specific version
# of Bodo, I'm requiring that we update the recipe in buildscripts/bodosql/conda-recipe/meta.yaml,
# and do a mini-release.

- stage: Build_BodoSQL_Binary
  displayName: 'Build BodoSQL Binary'
  dependsOn: Build_Bodo_Binary_Linux_Conda
  jobs:

  # BodoSQL build:
  - template: buildscripts/bodosql/azure/azure-build-binary.yml
    parameters:
      name: BodoSQL_Conda_Build
      CONDA_ENV: build_bodo_sql
      PYTHON_VERSION: 3.10
  - template: buildscripts/bodosql/azure/azure-build-binary-pip.yml
    parameters:
      name: BodoSQL_Pip_Build
      CONDA_ENV: build_bodo_sql
      PYTHON_VERSION: 3.10

  # Bodo tests
- stage: Test_Bodo_Binary
  displayName: 'Test Bodo Binary'
  dependsOn: Build_Bodo_Binary_Linux_Conda
  jobs:

  - template: buildscripts/azure/azure-test-binary-linux-macos.yml
    parameters:
      # Note: name is used later in the buildscripts to determine which version of conda to install
      name: Linux
      useNumbaDev: false
      caching_test: false
      PYTHON_VERSION: 3.10
      matrix:
        BODO_1P_1_OF_22:
          NP: 1
          CONDA_ENV: 'bodo'
          PYTEST_MARKER: bodo_1of22 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODO_1P_2_OF_22:
          NP: 1
          CONDA_ENV: 'bodo'
          PYTEST_MARKER: bodo_2of22 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODO_1P_3_OF_22:
          NP: 1
          CONDA_ENV: 'bodo'
          PYTEST_MARKER: bodo_3of22 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODO_1P_4_OF_22:
          NP: 1
          CONDA_ENV: 'bodo'
          PYTEST_MARKER: bodo_4of22 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODO_1P_5_OF_22:
          NP: 1
          CONDA_ENV: 'bodo'
          PYTEST_MARKER: bodo_5of22 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODO_1P_6_OF_22:
          NP: 1
          CONDA_ENV: 'bodo'
          PYTEST_MARKER: bodo_6of22 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODO_1P_7_OF_22:
          NP: 1
          CONDA_ENV: 'bodo'
          PYTEST_MARKER: bodo_7of22 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODO_1P_8_OF_22:
          NP: 1
          CONDA_ENV: 'bodo'
          PYTEST_MARKER: bodo_8of22 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODO_1P_9_OF_22:
          NP: 1
          CONDA_ENV: 'bodo'
          PYTEST_MARKER: bodo_9of22 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODO_1P_10_OF_22:
          NP: 1
          CONDA_ENV: 'bodo'
          PYTEST_MARKER: bodo_10of22 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODO_1P_11_OF_22:
          NP: 1
          CONDA_ENV: 'bodo'
          PYTEST_MARKER: bodo_11of22 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODO_1P_12_OF_22:
          NP: 1
          CONDA_ENV: 'bodo'
          PYTEST_MARKER: bodo_12of22 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODO_1P_13_OF_22:
          NP: 1
          CONDA_ENV: 'bodo'
          PYTEST_MARKER: bodo_13of22 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODO_1P_14_OF_22:
          NP: 1
          CONDA_ENV: 'bodo'
          PYTEST_MARKER: bodo_14of22 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODO_1P_15_OF_22:
          NP: 1
          CONDA_ENV: 'bodo'
          PYTEST_MARKER: bodo_15of22 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODO_1P_16_OF_22:
          NP: 1
          CONDA_ENV: 'bodo'
          PYTEST_MARKER: bodo_16of22 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODO_1P_17_OF_22:
          NP: 1
          CONDA_ENV: 'bodo'
          PYTEST_MARKER: bodo_17of22 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODO_1P_18_OF_22:
          NP: 1
          CONDA_ENV: 'bodo'
          PYTEST_MARKER: bodo_18of22 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODO_1P_19_OF_22:
          NP: 1
          CONDA_ENV: 'bodo'
          PYTEST_MARKER: bodo_19of22 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODO_1P_20_OF_22:
          NP: 1
          CONDA_ENV: 'bodo'
          PYTEST_MARKER: bodo_20of22 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODO_1P_21_OF_22:
          NP: 1
          CONDA_ENV: 'bodo'
          PYTEST_MARKER: bodo_21of22 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODO_1P_22_OF_22:
          NP: 1
          CONDA_ENV: 'bodo'
          PYTEST_MARKER: bodo_22of22 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODO_2P_1_OF_30:
          NP: 2
          CONDA_ENV: 'bodo'
          PYTEST_MARKER: bodo_1of30 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODO_2P_2_OF_30:
          NP: 2
          CONDA_ENV: 'bodo'
          PYTEST_MARKER: bodo_2of30 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODO_2P_3_OF_30:
          NP: 2
          CONDA_ENV: 'bodo'
          PYTEST_MARKER: bodo_3of30 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODO_2P_4_OF_30:
          NP: 2
          CONDA_ENV: 'bodo'
          PYTEST_MARKER: bodo_4of30 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODO_2P_5_OF_30:
          NP: 2
          CONDA_ENV: 'bodo'
          PYTEST_MARKER: bodo_5of30 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODO_2P_6_OF_30:
          NP: 2
          CONDA_ENV: 'bodo'
          PYTEST_MARKER: bodo_6of30 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODO_2P_7_OF_30:
          NP: 2
          CONDA_ENV: 'bodo'
          PYTEST_MARKER: bodo_7of30 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODO_2P_8_OF_30:
          NP: 2
          CONDA_ENV: 'bodo'
          PYTEST_MARKER: bodo_8of30 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODO_2P_9_OF_30:
          NP: 2
          CONDA_ENV: 'bodo'
          PYTEST_MARKER: bodo_9of30 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODO_2P_10_OF_30:
          NP: 2
          CONDA_ENV: 'bodo'
          PYTEST_MARKER: bodo_10of30 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODO_2P_11_OF_30:
          NP: 2
          CONDA_ENV: 'bodo'
          PYTEST_MARKER: bodo_11of30 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODO_2P_12_OF_30:
          NP: 2
          CONDA_ENV: 'bodo'
          PYTEST_MARKER: bodo_12of30 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODO_2P_13_OF_30:
          NP: 2
          CONDA_ENV: 'bodo'
          PYTEST_MARKER: bodo_13of30 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODO_2P_14_OF_30:
          NP: 2
          CONDA_ENV: 'bodo'
          PYTEST_MARKER: bodo_14of30 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODO_2P_15_OF_30:
          NP: 2
          CONDA_ENV: 'bodo'
          PYTEST_MARKER: bodo_15of30 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODO_2P_16_OF_30:
          NP: 2
          CONDA_ENV: 'bodo'
          PYTEST_MARKER: bodo_16of30 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODO_2P_17_OF_30:
          NP: 2
          CONDA_ENV: 'bodo'
          PYTEST_MARKER: bodo_17of30 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODO_2P_18_OF_30:
          NP: 2
          CONDA_ENV: 'bodo'
          PYTEST_MARKER: bodo_18of30 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODO_2P_19_OF_30:
          NP: 2
          CONDA_ENV: 'bodo'
          PYTEST_MARKER: bodo_19of30 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODO_2P_20_OF_30:
          NP: 2
          CONDA_ENV: 'bodo'
          PYTEST_MARKER: bodo_20of30 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODO_2P_21_OF_30:
          NP: 2
          CONDA_ENV: 'bodo'
          PYTEST_MARKER: bodo_21of30 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODO_2P_22_OF_30:
          NP: 2
          CONDA_ENV: 'bodo'
          PYTEST_MARKER: bodo_22of30 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODO_2P_23_OF_30:
          NP: 2
          CONDA_ENV: 'bodo'
          PYTEST_MARKER: bodo_23of30 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODO_2P_24_OF_30:
          NP: 2
          CONDA_ENV: 'bodo'
          PYTEST_MARKER: bodo_24of30 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODO_2P_25_OF_30:
          NP: 2
          CONDA_ENV: 'bodo'
          PYTEST_MARKER: bodo_25of30 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODO_2P_26_OF_30:
          NP: 2
          CONDA_ENV: 'bodo'
          PYTEST_MARKER: bodo_26of30 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODO_2P_27_OF_30:
          NP: 2
          CONDA_ENV: 'bodo'
          PYTEST_MARKER: bodo_27of30 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODO_2P_28_OF_30:
          NP: 2
          CONDA_ENV: 'bodo'
          PYTEST_MARKER: bodo_28of30 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODO_2P_29_OF_30:
          NP: 2
          CONDA_ENV: 'bodo'
          PYTEST_MARKER: bodo_29of30 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODO_2P_30_OF_30:
          NP: 2
          CONDA_ENV: 'bodo'
          PYTEST_MARKER: bodo_30of30 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true



  - template: buildscripts/azure/azure-test-binary-linux-macos.yml
    parameters:
      # Note: name is used later in the buildscripts to determine which version of conda to install
      name: Linux_cache
      useNumbaDev: false
      caching_test: true
      PYTHON_VERSION: 3.10
      matrix:
        TEST_2P:
          NP: 2
          CONDA_ENV: 'bodo'
          PYTEST_MARKER: ""

  # BodoSQL tests
- stage: Test_BodoSQL_Binary
  displayName: 'Test BodoSQL Binary'
  dependsOn: Build_BodoSQL_Binary
  jobs:

  - template: buildscripts/bodosql/azure/azure-test-binary-linux-macos.yml
    parameters:
      # Note: this name is not important, as we explicitly check uname to determine the os
      # for the bodoSQL tests
      name: BODOSQL_Linux
      BODO_CHANNEL_NAME: $(BODO_CHANNEL_NAME)
      CONDA_ENV: run_bodo_sql
      PYTHON_VERSION: 3.10
      matrix:
        BODOSQL_1P_1_OF_12:
          NP: 1
          PYTEST_MARKER: bodosql_1of12 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODOSQL_1P_2_OF_12:
          NP: 1
          PYTEST_MARKER: bodosql_2of12 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODOSQL_1P_3_OF_12:
          NP: 1
          PYTEST_MARKER: bodosql_3of12 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODOSQL_1P_4_OF_12:
          NP: 1
          PYTEST_MARKER: bodosql_4of12 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODOSQL_1P_5_OF_12:
          NP: 1
          PYTEST_MARKER: bodosql_5of12 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODOSQL_1P_6_OF_12:
          NP: 1
          PYTEST_MARKER: bodosql_6of12 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODOSQL_1P_7_OF_12:
          NP: 1
          PYTEST_MARKER: bodosql_7of12 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODOSQL_1P_8_OF_12:
          NP: 1
          PYTEST_MARKER: bodosql_8of12 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODOSQL_1P_9_OF_12:
          NP: 1
          PYTEST_MARKER: bodosql_9of12 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODOSQL_1P_10_OF_12:
          NP: 1
          PYTEST_MARKER: bodosql_10of12 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODOSQL_1P_11_OF_12:
          NP: 1
          PYTEST_MARKER: bodosql_11of12 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODOSQL_1P_12_OF_12:
          NP: 1
          PYTEST_MARKER: bodosql_12of12 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODOSQL_2P_1_OF_22:
          NP: 2
          PYTEST_MARKER: bodosql_1of22 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODOSQL_2P_2_OF_22:
          NP: 2
          PYTEST_MARKER: bodosql_2of22 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODOSQL_2P_3_OF_22:
          NP: 2
          PYTEST_MARKER: bodosql_3of22 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODOSQL_2P_4_OF_22:
          NP: 2
          PYTEST_MARKER: bodosql_4of22 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODOSQL_2P_5_OF_22:
          NP: 2
          PYTEST_MARKER: bodosql_5of22 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODOSQL_2P_6_OF_22:
          NP: 2
          PYTEST_MARKER: bodosql_6of22 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODOSQL_2P_7_OF_22:
          NP: 2
          PYTEST_MARKER: bodosql_7of22 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODOSQL_2P_8_OF_22:
          NP: 2
          PYTEST_MARKER: bodosql_8of22 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODOSQL_2P_9_OF_22:
          NP: 2
          PYTEST_MARKER: bodosql_9of22 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODOSQL_2P_10_OF_22:
          NP: 2
          PYTEST_MARKER: bodosql_10of22 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODOSQL_2P_11_OF_22:
          NP: 2
          PYTEST_MARKER: bodosql_11of22 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODOSQL_2P_12_OF_22:
          NP: 2
          PYTEST_MARKER: bodosql_12of22 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODOSQL_2P_13_OF_22:
          NP: 2
          PYTEST_MARKER: bodosql_13of22 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODOSQL_2P_14_OF_22:
          NP: 2
          PYTEST_MARKER: bodosql_14of22 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODOSQL_2P_15_OF_22:
          NP: 2
          PYTEST_MARKER: bodosql_15of22 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODOSQL_2P_16_OF_22:
          NP: 2
          PYTEST_MARKER: bodosql_16of22 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODOSQL_2P_17_OF_22:
          NP: 2
          PYTEST_MARKER: bodosql_17of22 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODOSQL_2P_18_OF_22:
          NP: 2
          PYTEST_MARKER: bodosql_18of22 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODOSQL_2P_19_OF_22:
          NP: 2
          PYTEST_MARKER: bodosql_19of22 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODOSQL_2P_20_OF_22:
          NP: 2
          PYTEST_MARKER: bodosql_20of22 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODOSQL_2P_21_OF_22:
          NP: 2
          PYTEST_MARKER: bodosql_21of22 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true
        BODOSQL_2P_22_OF_22:
          NP: 2
          PYTEST_MARKER: bodosql_22of22 and not weekly
          BODO_TESTING_PIPELINE_HAS_MULTI_RANK_TEST: true


  - template: buildscripts/bodosql/azure/azure-test-binary-linux-macos.yml
    parameters:
      # Note: this name is not important, as we explicitly pass CACHE_TEST and
      # check uname to determine the os for the bodoSQL tests
      name: BODOSQL_Linux_cache
      BODO_CHANNEL_NAME: $(BODO_CHANNEL_NAME)
      CONDA_ENV: build_bodo_sql
      PYTHON_VERSION: 3.10
      CACHE_TEST: true
      PYTEST_MARKER: ""
      matrix:
        TEST_2P:
          NP: 2

# Maven unit tests
- stage: Test_BodoSQL_Maven
  displayName: 'Test BodoSQL Maven unit tests'
  dependsOn: []
  jobs:

  - template: buildscripts/bodosql/azure/azure-test-mvn-linux.yml
    parameters:
      # NOTE: a few of these parameters may not actually be used.
      # I'm uncertain which are/aren't used by the helper bash
      # scripts, so I've decided to just leave them in for now for
      # saftey.
      name: BODOSQL_maven_unit_tests
      BODO_CHANNEL_NAME: $(BODO_CHANNEL_NAME)
      CONDA_ENV: build_bodo_sql
      PYTHON_VERSION: 3.10
